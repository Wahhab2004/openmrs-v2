"use strict";(globalThis.webpackChunk_openmrs_esm_patient_notes_app=globalThis.webpackChunk_openmrs_esm_patient_notes_app||[]).push([[623],{604:(e,t,n)=>{n.d(t,{Z:()=>s});var o=n(272),a=n.n(o),i=n(2609),r=n.n(i)()(a());r.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79;--bottom-nav-height: 4rem;--workspace-header-height: 3rem;--tablet-workspace-window-height: calc(100vh - var(--omrs-navbar-height));--desktop-workspace-window-height: calc(100vh - var(--omrs-navbar-height) - var(--workspace-header-height))}.-esm-patient-notes__visit-notes-form__heading___wghwA{font-size:var(--cds-heading-03-font-size, 1.25rem);font-weight:var(--cds-heading-03-font-weight, 400);line-height:var(--cds-heading-03-line-height, 1.4);letter-spacing:var(--cds-heading-03-letter-spacing, 0);margin-bottom:.5rem}.-esm-patient-notes__visit-notes-form__columnLabel___TmHhv{font-size:var(--cds-heading-compact-02-font-size, 1rem);font-weight:var(--cds-heading-compact-02-font-weight, 600);line-height:var(--cds-heading-compact-02-line-height, 1.375);letter-spacing:var(--cds-heading-compact-02-letter-spacing, 0);color:#525252}.-esm-patient-notes__visit-notes-form__diagnosis___czR8d{padding:.75rem;border-top:.0625rem solid #e0e0e0}.-esm-patient-notes__visit-notes-form__diagnosis___czR8d:first-of-type{border-top:none}.-esm-patient-notes__visit-notes-form__diagnosis___czR8d:last-of-type{border-bottom:none}.-esm-patient-notes__visit-notes-form__diagnosisList___FQwH4{background-color:#fff;max-height:13.5rem;overflow-y:auto;border:1px solid #e0e0e0}.-esm-patient-notes__visit-notes-form__diagnosisList___FQwH4 li:hover{background-color:#e0e0e0}.-esm-patient-notes__visit-notes-form__diagnosesText___BCPMx{font-size:var(--cds-body-compact-01-font-size, 0.875rem);font-weight:var(--cds-body-compact-01-font-weight, 400);line-height:var(--cds-body-compact-01-line-height, 1.28572);letter-spacing:var(--cds-body-compact-01-letter-spacing, 0.16px);color:#525252;margin-bottom:1rem}.-esm-patient-notes__visit-notes-form__emptyResults___FZkoC{font-size:var(--cds-body-compact-01-font-size, 0.875rem);font-weight:var(--cds-body-compact-01-font-weight, 400);line-height:var(--cds-body-compact-01-line-height, 1.28572);letter-spacing:var(--cds-body-compact-01-letter-spacing, 0.16px);color:#525252;min-height:1rem}.-esm-patient-notes__visit-notes-form__imgUploadHelperText___Kpw1u{font-size:var(--cds-body-compact-01-font-size, 0.875rem);font-weight:var(--cds-body-compact-01-font-weight, 400);line-height:var(--cds-body-compact-01-line-height, 1.28572);letter-spacing:var(--cds-body-compact-01-letter-spacing, 0.16px);color:#525252}.-esm-patient-notes__visit-notes-form__imgThumbnailContainer___PkaKm{height:5rem;width:6rem;margin-top:.75rem}.-esm-patient-notes__visit-notes-form__imgThumbnail___Ux1aD{width:100%;height:100%;object-fit:cover}.-esm-patient-notes__visit-notes-form__button___IfUcE{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-notes__visit-notes-form__tablet___AGKXz{padding:1.5rem 1rem;background-color:#fff}.-esm-patient-notes__visit-notes-form__desktop___XjbxY{padding:0rem}.-esm-patient-notes__visit-notes-form__headerGridRow___JT9ZC{border-bottom:.0625rem solid #e0e0e0;margin:0}.-esm-patient-notes__visit-notes-form__dataGridRow___ZmeiS{display:grid;grid-template-columns:50% 10% 1fr;margin:.5rem 1rem}.-esm-patient-notes__visit-notes-form__formContainer___J7UTF{margin:1rem}.-esm-patient-notes__visit-notes-form__form___p3e80{display:flex;flex-direction:column;justify-content:space-between;height:var(--desktop-workspace-window-height)}.-esm-patient-notes__visit-notes-form__grid___eScqB{margin:0rem;padding:0rem}.-esm-patient-notes__visit-notes-form__row___wi4CQ{margin:.5rem 0rem 2.5rem}.-esm-patient-notes__visit-notes-form__skeleton___Ia9Qj{margin-top:.25rem;height:2rem}.-esm-patient-notes__visit-notes-form__errorMessage___j785L{color:#da1e28}.-esm-patient-notes__visit-notes-form__diagnosisErrorOutline___rEgVA .cds--search-input:focus{outline:2.5px solid #da1e28}.-esm-patient-notes__visit-notes-form__diagnosisErrorOutline___rEgVA .cds--search-magnifier svg{fill:#da1e28}.-esm-patient-notes__visit-notes-form__errorMessage___j785L{font-size:var(--cds-label-02-font-size, 0.875rem);font-weight:var(--cds-label-02-font-weight, 400);line-height:var(--cds-label-02-line-height, 1.28572);letter-spacing:var(--cds-label-02-letter-spacing, 0.16px);color:#da1e28}.omrs-breakpoint-lt-desktop .-esm-patient-notes__visit-notes-form__form___p3e80{height:var(--tablet-workspace-window-height)}.omrs-breakpoint-lt-desktop .-esm-patient-notes__visit-notes-form__row___wi4CQ{display:flex;gap:4rem}.omrs-breakpoint-lt-desktop .-esm-patient-notes__visit-notes-form__row___wi4CQ .cds--col-sm-1{flex-basis:30%;min-width:8rem;text-align:left}.omrs-breakpoint-lt-desktop .-esm-patient-notes__visit-notes-form__row___wi4CQ .cds--col-sm-3{flex-basis:70%}.omrs-breakpoint-lt-desktop .-esm-patient-notes__visit-notes-form__diagnosis___czR8d{padding:1rem .75rem}.omrs-breakpoint-lt-desktop .-esm-patient-notes__visit-notes-form__skeleton___Ia9Qj{height:2.5rem}.-esm-patient-notes__visit-notes-form__errorNotification___TK64s{margin-top:.25rem}.-esm-patient-notes__visit-notes-form__tag___o9exi{margin-right:.5rem;margin-left:0}.-esm-patient-notes__visit-notes-form__uploadButton___lJDgI{margin-top:1rem}","",{version:3,sources:["webpack://./../../node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/notes/visit-notes-form.scss","webpack://./../../node_modules/@carbon/type/scss/_styles.scss","webpack://./../../node_modules/@carbon/layout/scss/generated/_spacing.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CACA,yBAAA,CACA,+BAAA,CACA,yEAAA,CACA,2GAAA,CCvDF,uDC81BI,kDAAA,CAAA,kDAAA,CAAA,kDAAA,CAAA,sDAAA,CD51BF,mBAAA,CAGF,2DCy1BI,uDAAA,CAAA,0DAAA,CAAA,4DAAA,CAAA,8DAAA,CDv1BF,aDNQ,CCSV,yDACE,cAAA,CACA,iCAAA,CAGF,uEACE,eAAA,CAGF,sEACE,kBAAA,CAGF,6DACE,qBD3BM,CC4BN,kBAAA,CACA,eAAA,CACA,wBAAA,CAGF,sEACE,wBDjCM,CCoCR,6DC4zBI,wDAAA,CAAA,uDAAA,CAAA,2DAAA,CAAA,gEAAA,CD1zBF,aDnCQ,CCoCR,kBAAA,CAGF,4DCszBI,wDAAA,CAAA,uDAAA,CAAA,2DAAA,CAAA,gEAAA,CDpzBF,aDzCQ,CC0CR,eAAA,CAGF,mECgzBI,wDAAA,CAAA,uDAAA,CAAA,2DAAA,CAAA,gEAAA,CD9yBF,aD/CQ,CCkDV,qEACE,WAAA,CACA,UAAA,CACA,iBEhCW,CFmCb,4DACE,UAAA,CACA,WAAA,CACA,gBAAA,CAGF,sDACE,WAAA,CACA,YAAA,CACA,wBAAA,CACA,oBAAA,CACA,aAAA,CAGF,sDACE,mBAAA,CACA,qBD5EM,CC+ER,uDACE,YAAA,CAGF,6DACE,oCAAA,CACA,QAAA,CAGF,2DACE,YAAA,CACA,iCAAA,CACA,iBAAA,CAGF,6DACE,WAAA,CAGF,oDACE,YAAA,CACA,qBAAA,CACA,6BAAA,CACA,6CAAA,CAGF,oDACE,WAAA,CACA,YAAA,CAGF,mDACE,wBAAA,CAGF,wDACE,iBAAA,CACA,WAAA,CAGF,4DACE,aDrGO,CCyGP,8FACE,2BAAA,CAIA,gGACE,YD/GG,CCoHT,4DC0tBI,iDAAA,CAAA,gDAAA,CAAA,oDAAA,CAAA,yDAAA,CDxtBF,aDtHO,CC0HP,gFACE,4CAAA,CAGF,+EACE,YAAA,CACA,QAAA,CAEA,8FACE,cAAA,CACA,cAAA,CACA,eAAA,CAGF,8FACE,cAAA,CAIJ,qFACE,mBAAA,CAGF,oFACE,aAAA,CAIJ,iEACE,iBAAA,CAGF,mDACE,kBAAA,CACA,aAAA,CAGF,4DACE,eAAA",sourceRoot:""}]),r.locals={heading:"-esm-patient-notes__visit-notes-form__heading___wghwA",columnLabel:"-esm-patient-notes__visit-notes-form__columnLabel___TmHhv",diagnosis:"-esm-patient-notes__visit-notes-form__diagnosis___czR8d",diagnosisList:"-esm-patient-notes__visit-notes-form__diagnosisList___FQwH4",diagnosesText:"-esm-patient-notes__visit-notes-form__diagnosesText___BCPMx",emptyResults:"-esm-patient-notes__visit-notes-form__emptyResults___FZkoC",imgUploadHelperText:"-esm-patient-notes__visit-notes-form__imgUploadHelperText___Kpw1u",imgThumbnailContainer:"-esm-patient-notes__visit-notes-form__imgThumbnailContainer___PkaKm",imgThumbnail:"-esm-patient-notes__visit-notes-form__imgThumbnail___Ux1aD",button:"-esm-patient-notes__visit-notes-form__button___IfUcE",tablet:"-esm-patient-notes__visit-notes-form__tablet___AGKXz",desktop:"-esm-patient-notes__visit-notes-form__desktop___XjbxY",headerGridRow:"-esm-patient-notes__visit-notes-form__headerGridRow___JT9ZC",dataGridRow:"-esm-patient-notes__visit-notes-form__dataGridRow___ZmeiS",formContainer:"-esm-patient-notes__visit-notes-form__formContainer___J7UTF",form:"-esm-patient-notes__visit-notes-form__form___p3e80",grid:"-esm-patient-notes__visit-notes-form__grid___eScqB",row:"-esm-patient-notes__visit-notes-form__row___wi4CQ",skeleton:"-esm-patient-notes__visit-notes-form__skeleton___Ia9Qj",errorMessage:"-esm-patient-notes__visit-notes-form__errorMessage___j785L",diagnosisErrorOutline:"-esm-patient-notes__visit-notes-form__diagnosisErrorOutline___rEgVA",errorNotification:"-esm-patient-notes__visit-notes-form__errorNotification___TK64s",tag:"-esm-patient-notes__visit-notes-form__tag___o9exi",uploadButton:"-esm-patient-notes__visit-notes-form__uploadButton___lJDgI"};const s=r},2623:(e,t,n)=>{n.r(t),n.d(t,{default:()=>U});var o=n(268),a=n.n(o),i=n(3565),r=n.n(i),s=n(1456),l=n(4924),c=n(3255),m=n(195),A=n(8883),_=n(3955),d=n(5676),u=n(5362),g=n(810),p=n(6615),f=n(2870),C=n(3236),h=n(321),v=n.n(h),b=n(1195),E=n.n(b),y=n(3275),D=n.n(y),w=n(7162),k=n.n(w),S=n(2094),N=n.n(S),B=n(757),F=n.n(B),x=n(604),T={};T.styleTagTransform=F(),T.setAttributes=k(),T.insert=D().bind(null,"head"),T.domAPI=E(),T.insertStyleElement=N(),v()(x.Z,T);const G=x.Z&&x.Z.locals?x.Z.locals:void 0;function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){z(e,t,n[t])}))}return e}function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,a,i=[],r=!0,s=!1;try{for(n=n.call(e);!(r=(o=n.next()).done)&&(i.push(o.value),!t||i.length!==t);r=!0);}catch(e){s=!0,a=e}finally{try{r||null==n.return||n.return()}finally{if(s)throw a}}return i}}(e,t)||P(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e){return function(e){if(Array.isArray(e))return I(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||P(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){if(e){if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(e,t):void 0}}var H=["jpeg","jpg","png","webp"],O=m.z.object({noteDate:m.z.date(),primaryDiagnosisSearch:m.z.string({required_error:"Choose at least one primary diagnosis"}),secondaryDiagnosisSearch:m.z.string().optional(),clinicalNote:m.z.string().optional(),image:m.z.any()});const U=function(e){var t,n,i,m=e.closeWorkspace,p=e.closeWorkspaceWithSavedChanges,h=e.patientUuid,v=e.promptBeforeClosing,b=(0,l.useTranslation)().t,E="tablet"===(0,f.useLayoutType)(),y=(0,f.useSession)(),D=(0,f.useConfig)(),w=(0,o.useMemo)((function(){return{patientUuid:h}}),[h]),k=D.visitNoteConfig,S=k.clinicianEncounterRole,N=k.encounterNoteTextConceptUuid,B=k.encounterTypeUuid,F=k.formConceptUuid,x=j((0,o.useState)(!1),2),T=x[0],I=x[1],z=j((0,o.useState)(!1),2),P=z[0],U=z[1],V=j((0,o.useState)(!1),2),W=V[0],K=V[1],Z=j((0,o.useState)(!1),2),q=Z[0],X=Z[1],Y=j((0,o.useState)([]),2),J=Y[0],$=Y[1],ee=j((0,o.useState)([]),2),te=ee[0],ne=ee[1],oe=j((0,o.useState)(null),2),ae=oe[0],ie=oe[1],re=j((0,o.useState)(null),2),se=re[0],le=re[1],ce=j((0,o.useState)([]),2),me=ce[0],Ae=ce[1],_e=j((0,o.useState)(),2),de=_e[0],ue=_e[1],ge=j((0,o.useState)(null),2),pe=ge[0],fe=ge[1],Ce=(0,_.cI)({mode:"onSubmit",resolver:(0,A.F)(O),defaultValues:{noteDate:new Date}}),he=Ce.control,ve=Ce.handleSubmit,be=Ce.watch,Ee=(Ce.getValues,Ce.setValue),ye=Ce.formState,De=ye.isDirty;(0,o.useEffect)((function(){v((function(){return De}))}),[De,v]);var we=be("image"),ke=(0,C.q6)(h).mutateVisitNotes,Se=(0,C.OD)(h).mutateVisits,Ne=null==y||null===(t=y.sessionLocation)||void 0===t?void 0:t.uuid,Be=null==y||null===(n=y.currentProvider)||void 0===n?void 0:n.uuid,Fe=function(e){var t=be(e);t&&xe(t,e),X(!1)},xe=(0,o.useMemo)((function(){return(0,s.Z)((function(e,t){e&&("primaryDiagnosisSearch"===t?U(!0):"secondaryDiagnosisSearch"===t&&K(!0),(0,C.ov)(e,D.diagnosisConceptClass).then((function(e){"primaryDiagnosisSearch"==t?(ie(e),U(!1)):"secondaryDiagnosisSearch"==t&&(le(e),K(!1))})).catch((function(e){fe(e),(0,f.createErrorHandler)()})))}),500)}),[D.diagnosisConceptClass]),Te=function(e,t){var n=ze(e);"primaryDiagnosisSearch"==t?(n.rank=1,Ee("primaryDiagnosisSearch",""),ie([]),$((function(e){return L(e).concat([n])}))):"secondaryDiagnosisSearch"==t&&(Ee("secondaryDiagnosisSearch",""),le([]),ne((function(e){return L(e).concat([n])}))),Ae((function(e){return L(e).concat([n])}))},Ge=function(e,t){"primaryInputSearch"==t?$(J.filter((function(t){return t.diagnosis.coded!==e.diagnosis.coded}))):"secondaryInputSearch"==t&&ne(te.filter((function(t){return t.diagnosis.coded!==e.diagnosis.coded}))),Ae(me.filter((function(t){return t.diagnosis.coded!==e.diagnosis.coded})))},Ie=function(e){var t=J.some((function(t){return e.uuid===t.diagnosis.coded})),n=te.some((function(t){return e.uuid===t.diagnosis.coded}));return!t&&!n},ze=function(e){return{patient:h,diagnosis:{coded:e.uuid},rank:2,certainty:"PROVISIONAL",display:e.display}},Re=(0,o.useCallback)((function(){var e=(0,f.showModal)("capture-photo-modal",{saveFile:function(t){return Ee("image",t),e(),Promise.resolve()},closeModal:function(){e()},allowedExtensions:H,multipleFiles:!1,collectDescription:!1})}),[Ee]),je=(0,o.useCallback)((function(e,t){var n=e.noteDate,o=e.clinicalNote;if(I(!0),J.length){var a=r()(n),i=new Date;a.diff(i,"minute")<=30&&(a=null);var s={encounterDatetime:null==a?void 0:a.format(),form:F,patient:h,location:Ne,encounterProviders:[{encounterRole:S,provider:Be}],encounterType:B,obs:o?[{concept:{uuid:N,display:""},value:o}]:[]},l=new AbortController;(0,C.aH)(l,s).then((function(e){if(201===e.status)return Promise.all(me.map((function(t,n){var o={encounter:e.data.uuid,patient:h,condition:null,diagnosis:{coded:t.diagnosis.coded},certainty:t.certainty,rank:t.rank};return(0,C.BH)(l,o)})))})).then((function(){if(e.image)return(0,f.createAttachment)(h,e.image)})).then((function(){ke(),Se(),e.image&&(0,c.JG)((function(e){return"string"==typeof e&&e.startsWith("".concat(f.restBaseUrl,"/attachment"))})),p(),(0,f.showSnackbar)({isLowContrast:!0,subtitle:b("visitNoteNowVisible","It is now visible on the Encounters page"),kind:"success",title:b("visitNoteSaved","Visit note saved")})})).catch((function(e){(0,f.createErrorHandler)(),(0,f.showSnackbar)({title:b("visitNoteSaveError","Error saving visit note"),kind:"error",isLowContrast:!1,subtitle:null==e?void 0:e.message})})).finally((function(){I(!1),l.abort()}))}else I(!1)}),[J.length,F,h,Ne,S,Be,B,N,me,ke,p,b,Se]);return a().createElement(d.l09,{className:G.form,onSubmit:ve(je,(function(e){return console.error(e)}))},E&&a().createElement(d.X2j,{className:G.headerGridRow},a().createElement(f.ExtensionSlot,{name:"visit-form-header-slot",className:G.dataGridRow,state:w})),a().createElement(d.Kqy,{className:G.formContainer,gap:2},E?a().createElement("h2",{className:G.heading},b("addVisitNote","Add a visit note")):null,a().createElement(d.X2j,{className:G.row},a().createElement(d.sgG,{sm:1},a().createElement("span",{className:G.columnLabel},b("date","Date"))),a().createElement(d.sgG,{sm:3},a().createElement(_.Qr,{name:"noteDate",control:he,render:function(e){var t=e.field,n=t.onChange,o=t.value;return a().createElement(f.ResponsiveWrapper,null,a().createElement(d.Mtg,{dateFormat:"d/m/Y",datePickerType:"single",maxDate:(new Date).toISOString(),value:o,onChange:function(e){var t=j(e,1)[0];return n(t)}},a().createElement(d.aj6,{id:"visitDateTimePicker",labelText:b("visitDate","Visit date"),placeholder:"dd/mm/yyyy"})))}}))),a().createElement("div",{className:G.diagnosesText},J&&J.length?a().createElement(a().Fragment,null,J.map((function(e,t){return a().createElement(d.Vp9,{className:G.tag,filter:!0,key:t,onClose:function(){return Ge(e,"primaryInputSearch")},type:"red"},e.display)}))):null,te&&te.length?a().createElement(a().Fragment,null,te.map((function(e,t){return a().createElement(d.Vp9,{classname:G.tag,filter:!0,key:t,onClose:function(){return Ge(e,"secondaryInputSearch")},type:"blue"},e.display)}))):null,J&&!J.length&&te&&!te.length&&a().createElement("span",null,b("emptyDiagnosisText","No diagnosis selected â€” Enter a diagnosis below"))),a().createElement(d.X2j,{className:G.row},a().createElement(d.sgG,{sm:1},a().createElement("span",{className:G.columnLabel},b("primaryDiagnosis","Primary diagnosis"))),a().createElement(d.sgG,{sm:3},a().createElement(d.cwH,{legendText:b("searchForPrimaryDiagnosis","Search for a primary diagnosis")},a().createElement(Q,{name:"primaryDiagnosisSearch",control:he,labelText:b("enterPrimaryDiagnoses","Enter Primary diagnoses"),placeholder:b("primaryDiagnosisInputPlaceholder","Choose a primary diagnosis"),handleSearch:Fe,error:null==ye||null===(i=ye.errors)||void 0===i?void 0:i.primaryDiagnosisSearch,setIsSearching:X}),pe?a().createElement(d.K0D,{className:G.errorNotification,lowContrast:!0,title:b("error","Error"),subtitle:b("errorFetchingConcepts","There was a problem fetching concepts")+".",onClose:function(){return fe(null)}}):null,a().createElement(M,{fieldName:"primaryDiagnosisSearch",isDiagnosisNotSelected:Ie,isLoading:P,isSearching:q,onAddDiagnosis:Te,searchResults:ae,t:b,value:be("primaryDiagnosisSearch")})))),a().createElement(d.X2j,{className:G.row},a().createElement(d.sgG,{sm:1},a().createElement("span",{className:G.columnLabel},b("secondaryDiagnosis","Secondary diagnosis"))),a().createElement(d.sgG,{sm:3},a().createElement(d.cwH,{legendText:b("searchForSecondaryDiagnosis","Search for a secondary diagnosis")},a().createElement(Q,{name:"secondaryDiagnosisSearch",control:he,labelText:b("enterSecondaryDiagnoses","Enter Secondary diagnoses"),placeholder:b("secondaryDiagnosisInputPlaceholder","Choose a secondary diagnosis"),handleSearch:Fe,setIsSearching:X}),pe?a().createElement(d.K0D,{className:G.errorNotification,lowContrast:!0,title:b("error","Error"),subtitle:b("errorFetchingConcepts","There was a problem fetching concepts")+".",onClose:function(){return fe(null)}}):null,a().createElement(M,{fieldName:"secondaryDiagnosisSearch",isDiagnosisNotSelected:Ie,isLoading:W,isSearching:q,onAddDiagnosis:Te,searchResults:se,t:b,value:be("secondaryDiagnosisSearch")})))),a().createElement(d.X2j,{className:G.row},a().createElement(d.sgG,{sm:1},a().createElement("span",{className:G.columnLabel},b("note","Note"))),a().createElement(d.sgG,{sm:3},a().createElement(_.Qr,{name:"clinicalNote",control:he,render:function(e){var t=e.field,n=t.onChange,o=t.onBlur,i=t.value;return a().createElement(f.ResponsiveWrapper,null,a().createElement(d.Kx8,{id:"additionalNote",rows:de,labelText:b("clinicalNoteLabel","Write your notes"),placeholder:b("clinicalNotePlaceholder","Write any notes here"),value:i,onBlur:o,onChange:function(e){n(e);var t=Math.ceil(e.target.scrollHeight/24);ue(t)}}))}}))),a().createElement(d.X2j,{className:G.row},a().createElement(d.sgG,{sm:1},a().createElement("span",{className:G.columnLabel},b("image","Image"))),a().createElement(d.sgG,{sm:3},a().createElement(d.cwH,{legendText:""},a().createElement("p",{className:G.imgUploadHelperText},b("imageUploadHelperText","Upload an image or use this device's camera to capture an image")),(null==we?void 0:we.base64Content)?a().createElement(d.zxk,{className:G.uploadButton,kind:E?"ghost":"tertiary",onClick:function(){return Re()},renderIcon:function(e){return a().createElement(u.I8,R({size:16},e))}},b("changeImage","Change image")):a().createElement(d.zxk,{className:G.uploadButton,kind:E?"ghost":"tertiary",onClick:function(){return Re()},renderIcon:function(e){return a().createElement(g.mm,R({size:16},e))}},b("addImage","Add image")),(null==we?void 0:we.base64Content)&&"image"==(null==we?void 0:we.fileType)?a().createElement("div",{className:G.imgThumbnailContainer},a().createElement("img",{src:we.base64Content,className:G.imgThumbnail})):null)))),a().createElement(d.uVA,{className:E?G.tablet:G.desktop},a().createElement(d.zxk,{className:G.button,kind:"secondary",onClick:m},b("discard","Discard")),a().createElement(d.zxk,{className:G.button,kind:"primary",onClick:ve,disabled:T,type:"submit"},b("saveAndClose","Save and close"))))};function Q(e){var t=e.name,n=e.control,i=e.labelText,r=e.placeholder,s=e.handleSearch,l=e.error,c=e.setIsSearching,m="tablet"===(0,f.useLayoutType)(),A=(0,o.useRef)(null);return(0,o.useEffect)((function(){l&&A.current.focus()}),[l]),a().createElement(_.Qr,{name:t,control:n,render:function(e){var n,o=e.field,_=o.value,u=o.onChange,g=o.onBlur,C=e.fieldState;return a().createElement(a().Fragment,null,a().createElement(f.ResponsiveWrapper,null,a().createElement(d.olm,{ref:A,size:m?"lg":"md",id:t,labelText:i,className:l&&G.diagnosisErrorOutline,placeholder:r,renderIcon:l&&function(e){return a().createElement(p.Rr,R({fill:"red"},e))},onChange:function(e){c(!0),u(e),s(t)},value:_,onBlur:g})),a().createElement("p",{className:G.errorMessage},null==C||null===(n=C.error)||void 0===n?void 0:n.message))}})}function M(e){var t=e.fieldName,n=e.isDiagnosisNotSelected,o=e.isLoading,i=e.isSearching,r=e.onAddDiagnosis,s=e.searchResults,l=e.t,c=e.value;return c?i||o?a().createElement(V,null):!i&&(null==s?void 0:s.length)>0?a().createElement("ul",{className:G.diagnosisList},s.map((function(e,o){if(n(e))return a().createElement("li",{className:G.diagnosis,key:o,onClick:function(){return r(e,t)},role:"menuitem"},e.display)}))):0===(null==s?void 0:s.length)?a().createElement(f.ResponsiveWrapper,null,a().createElement(d.n9L,{className:G.emptyResults},a().createElement("span",null,l("noMatchingDiagnoses","No diagnoses found matching")," ",a().createElement("strong",null,'"',c,'"')))):void 0:null}function V(){return a().createElement(a().Fragment,null,a().createElement(d.N2B,{className:G.skeleton}),a().createElement(d.N2B,{className:G.skeleton}),a().createElement(d.N2B,{className:G.skeleton}),a().createElement(d.N2B,{className:G.skeleton}),a().createElement(d.N2B,{className:G.skeleton}))}}}]);