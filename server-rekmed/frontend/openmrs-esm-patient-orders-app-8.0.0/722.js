"use strict";(globalThis.webpackChunk_openmrs_esm_patient_orders_app=globalThis.webpackChunk_openmrs_esm_patient_orders_app||[]).push([[722],{9286:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(272),a=r.n(n),l=r(2609),o=r.n(l)()(a());o.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79;--bottom-nav-height: 4rem;--workspace-header-height: 3rem;--tablet-workspace-window-height: calc(100vh - var(--omrs-navbar-height));--desktop-workspace-window-height: calc(100vh - var(--omrs-navbar-height) - var(--workspace-header-height))}.-esm-patient-orders__lab-results-form__heading___RblWx{margin-bottom:1rem}.-esm-patient-orders__lab-results-form__loaderContainer___DrEdy{display:flex;justify-content:center;align-items:center;height:100%}.-esm-patient-orders__lab-results-form__loader___d641c{height:calc(100vh - 6rem);justify-content:center;align-items:center}.-esm-patient-orders__lab-results-form__sectionTitle___PJUHB{margin-bottom:.75rem}.-esm-patient-orders__lab-results-form__modalBody___l7R89{padding-bottom:1rem}.-esm-patient-orders__lab-results-form__textInput___Oj60x{margin:.25rem 0 1rem}.-esm-patient-orders__lab-results-form__errorDiv___BKzyE{color:#da1e28}.-esm-patient-orders__lab-results-form__button___OU0zR{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-orders__lab-results-form__button___OU0zR .cds--inline-loading{min-height:1rem !important}.-esm-patient-orders__lab-results-form__button___OU0zR .cds--inline-loading__text{font-size:unset !important}.-esm-patient-orders__lab-results-form__tablet___X5EJn{padding:1.5rem 1rem;background-color:#fff}.-esm-patient-orders__lab-results-form__desktop___VMGvv{padding:0rem}.-esm-patient-orders__lab-results-form__form___NrDRc{display:flex;flex-direction:column;justify-content:space-between;height:calc(100vh - 6rem)}.omrs-breakpoint-lt-desktop .-esm-patient-orders__lab-results-form__form___NrDRc{background-color:#ededed}.omrs-breakpoint-gt-tablet .-esm-patient-orders__lab-results-form__form___NrDRc{background-color:#fff}.-esm-patient-orders__lab-results-form__grid___w3wm2{margin:1rem}.-esm-patient-orders__lab-results-form__row___c8rmK{margin:.5rem 0rem 0rem;display:flex;flex-flow:row wrap;gap:1rem}.-esm-patient-orders__lab-results-form__spacer___Aq5pU{margin-top:1rem}","",{version:3,sources:["webpack://./../../node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/lab-results/lab-results-form.scss","webpack://./../../node_modules/@carbon/layout/scss/generated/_spacing.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CACA,yBAAA,CACA,+BAAA,CACA,yEAAA,CACA,2GAAA,CCvDF,wDACE,kBAAA,CAGF,gEACE,YAAA,CACA,sBAAA,CACA,kBAAA,CACA,WAAA,CAGF,uDACE,yBAAA,CACA,sBAAA,CACA,kBAAA,CAGF,6DACE,oBCIW,CDDb,0DACE,mBCKW,CDFb,0DACE,oBAAA,CAGF,yDACE,aDdO,CCiBT,uDACE,WAAA,CACA,YAAA,CACA,wBAAA,CACA,oBAAA,CACA,aAAA,CAEA,4EACE,0BAAA,CAGF,kFACE,0BAAA,CAIJ,uDACE,mBAAA,CACA,qBDtDM,CCyDR,wDACE,YAAA,CAGF,qDACE,YAAA,CACA,qBAAA,CACA,6BAAA,CACA,yBAAA,CAGF,iFACE,wBAAA,CAGF,gFACE,qBDzEM,CC4ER,qDACE,WC/CW,CDkDb,oDACE,sBAAA,CACA,YAAA,CACA,kBAAA,CACA,QCtDW,CDyDb,uDACE,eC1DW",sourceRoot:""}]),o.locals={heading:"-esm-patient-orders__lab-results-form__heading___RblWx",loaderContainer:"-esm-patient-orders__lab-results-form__loaderContainer___DrEdy",loader:"-esm-patient-orders__lab-results-form__loader___d641c",sectionTitle:"-esm-patient-orders__lab-results-form__sectionTitle___PJUHB",modalBody:"-esm-patient-orders__lab-results-form__modalBody___l7R89",textInput:"-esm-patient-orders__lab-results-form__textInput___Oj60x",errorDiv:"-esm-patient-orders__lab-results-form__errorDiv___BKzyE",button:"-esm-patient-orders__lab-results-form__button___OU0zR",tablet:"-esm-patient-orders__lab-results-form__tablet___X5EJn",desktop:"-esm-patient-orders__lab-results-form__desktop___VMGvv",form:"-esm-patient-orders__lab-results-form__form___NrDRc",grid:"-esm-patient-orders__lab-results-form__grid___w3wm2",row:"-esm-patient-orders__lab-results-form__row___c8rmK",spacer:"-esm-patient-orders__lab-results-form__spacer___Aq5pU"};const s=o},6722:(e,t,r)=>{r.r(t),r.d(t,{default:()=>S});var n=r(268),a=r.n(n),l=r(4924),o=r(3955),s=r(2870),i=r(5835),u=r(4216),d=r(321),c=r.n(d),_=r(1195),m=r.n(_),p=r(3275),A=r.n(p),f=r(7162),b=r.n(f),v=r(2094),y=r.n(v),C=r(757),g=r.n(C),h=r(9286),E={};E.styleTagTransform=g(),E.setAttributes=b(),E.insert=A().bind(null,"head"),E.domAPI=m(),E.insertStyleElement=y(),c()(h.Z,E);const k=h.Z&&h.Z.locals?h.Z.locals:void 0;function w(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){w(e,t,r[t])}))}return e}function x(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const B=function(e){var t=e.defaultValue,r=(e.register,e.concept),n=e.control,s=e.errors,u=(0,l.useTranslation)().t,d=function(e){var t,r;return"Text"===(null===(t=e.datatype)||void 0===t?void 0:t.display)||"Numeric"===(null===(r=e.datatype)||void 0===r?void 0:r.display)},c=function(e){var t;return"Coded"===(null===(t=e.datatype)||void 0===t?void 0:t.display)},_=function(e){var t;if("Numeric"===(null==e||null===(t=e.datatype)||void 0===t?void 0:t.display)){var r,n=Math.max(null==e?void 0:e.hiAbsolute,null==e?void 0:e.hiCritical,null==e?void 0:e.hiNormal),a=Math.min(null==e?void 0:e.lowAbsolute,null==e?void 0:e.lowCritical,null==e?void 0:e.lowNormal);return"(".concat(null!=a?a:0," - ").concat(n>0?n:"--"," ").concat(null!==(r=null==e?void 0:e.units)&&void 0!==r?r:"",")")}return""},m=function(e,r){var n,a,l,o,s;return"Coded"===r?null==t||null===(l=t.groupMembers)||void 0===l||null===(a=l.find((function(t){return t.concept.uuid===e})))||void 0===a||null===(n=a.value)||void 0===n?void 0:n.uuid:null==t||null===(s=t.groupMembers)||void 0===s||null===(o=s.find((function(t){return t.concept.uuid===e})))||void 0===o?void 0:o.value};return a().createElement(a().Fragment,null,Object.keys(s).length>0&&a().createElement("div",{className:k.errorDiv},"All fields are required"),d(r)&&a().createElement(o.Qr,{name:r.uuid,control:n,rules:{required:!0},render:function(e){var n,l=e.field;return a().createElement(i.oil,x(D({key:r.uuid,className:k.textInput},l),{type:"Numeric"===r.datatype.display?"number":"text",labelText:(null==r?void 0:r.display)+("Numeric"===r.datatype.display&&null!==(n=" ".concat(_(r)))&&void 0!==n?n:""),defaultValue:null==t?void 0:t.value,autoFocus:!0}))}}),c(r)&&a().createElement(o.Qr,{name:r.uuid,control:n,rules:{required:!0},render:function(e){var n,l,o,s=e.field;return a().createElement(i.PhF,x(D({key:r.uuid,className:k.textInput},s),{invalidText:u("required","Required"),labelText:null==r?void 0:r.display,rules:{required:!0},defaultValue:null==t||null===(n=t.value)||void 0===n?void 0:n.uuid}),a().createElement(i.QlF,{text:u("option","Choose an Option"),value:""}),(null==r||null===(l=r.answers)||void 0===l?void 0:l.length)&&(null==r||null===(o=r.answers)||void 0===o?void 0:o.map((function(e){return a().createElement(i.QlF,{key:e.uuid,text:e.display,value:e.uuid},e.display)}))))}}),function(e){var t;return(null===(t=e.setMembers)||void 0===t?void 0:t.length)>0}(r)&&r.setMembers.map((function(e,t){return d(e)?a().createElement(o.Qr,{control:n,name:e.uuid,rules:{required:!0},render:function(r){var n,l=r.field;return a().createElement(i.oil,x(D({key:e.uuid,className:k.textInput},l),{type:"Numeric"===e.datatype.display?"number":"text",labelText:(null==e?void 0:e.display)+("Numeric"===e.datatype.display&&null!==(n=_(e))&&void 0!==n?n:""),autoFocus:0===t,defaultValue:m(e.uuid,e.datatype.display)}))}}):c(e)?a().createElement(o.Qr,{name:e.uuid,control:n,rules:{required:!0},render:function(r){var n,l=r.field;return a().createElement(i.PhF,x(D({key:e.uuid,className:k.textInput},l),{type:"text",labelText:null==e?void 0:e.display,autoFocus:0===t,defaultValue:m(e.uuid,e.datatype.display)}),a().createElement(i.QlF,{text:u("option","Choose an Option"),value:""}),null==e||null===(n=e.answers)||void 0===n?void 0:n.map((function(e){return a().createElement(i.QlF,{key:e.uuid,text:e.display,value:e.uuid},e.display)})))}}):void 0})))};function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,l=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(l.push(n.value),!t||l.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==r.return||r.return()}finally{if(s)throw a}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return O(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?O(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const S=function(e){var t=e.order,r=e.closeWorkspace,d=e.closeWorkspaceWithSavedChanges,c=e.promptBeforeClosing,_=(0,l.useTranslation)().t,m=(0,s.useAbortController)(),p="tablet"===(0,s.useLayoutType)(),A=N((0,n.useState)(""),2),f=A[0],b=A[1],v=N((0,n.useState)(!1),2),y=v[0],C=v[1],g=N((0,n.useState)(!1),2),h=g[0],E=g[1],w=N((0,n.useState)(null),2),D=w[0],x=w[1],O=N((0,n.useState)(!1),2),S=O[0],F=O[1],j=(0,u.vk)(t.concept.uuid),T=j.concept,R=j.isLoading,I=(0,u.YZ)(t.encounter.uuid),M=I.encounter,P=I.isLoading,q=I.mutate,L=(0,o.cI)({defaultValues:{}}),V=L.control,W=L.register,G=L.formState,z=G.errors,Q=G.isDirty,U=L.getValues,K=L.handleSubmit;return!P&&(null==M?void 0:M.obs.length)>0&&!y&&(b(M.obs.find((function(e){var r;return(null===(r=e.order)||void 0===r?void 0:r.uuid)===t.uuid})).uuid),C(!0)),y&&!f&&(F(!0),(0,u.$f)(f).then((function(e){e&&x(e),F(!1)}))),(0,n.useEffect)((function(){c((function(){return Q}))}),[Q,c]),R?a().createElement("div",{className:k.loaderContainer},a().createElement(i.lSo,{className:k.loader,description:_("loadingTestDetails","Loading test details")+"...",iconDescription:_("loading","Loading"),status:"active"})):a().createElement(i.l09,{className:k.form},a().createElement("div",{className:k.grid},T.setMembers.length>0&&a().createElement("p",{className:k.heading},T.display),T&&a().createElement(i.Kqy,{gap:2},S?a().createElement(i.lSo,{description:_("loadingInitialValues","Loading Initial Values")+"..."}):a().createElement(B,{defaultValue:D,register:W,concept:T,control:V,errors:z}))),a().createElement(i.uVA,{className:p?k.tablet:k.desktop},a().createElement(i.zxk,{className:k.button,kind:"secondary",disabled:h,onClick:r},_("discard","Discard")),a().createElement(i.zxk,{className:k.button,kind:"primary",onClick:K((function(e,r){E(!0),r.preventDefault(),U();var n=[];if(T.set&&T.setMembers.length>0){var a=[];T.setMembers.forEach((function(e){var r;"Numeric"===e.datatype.display||"Text"===e.datatype.display?r=U()["".concat(e.uuid)]:"Coded"===e.datatype.display&&(r={uuid:U()["".concat(e.uuid)]});var n={concept:{uuid:e.uuid},value:r,status:"FINAL",order:{uuid:t.uuid}};a.push(n)})),n.push({concept:{uuid:t.concept.uuid},status:"FINAL",order:{uuid:t.uuid},groupMembers:a})}else if(!T.set&&0===T.setMembers.length){var l;"Numeric"===T.datatype.display||"Text"===T.datatype.display?l=U()["".concat(T.uuid)]:"Coded"===T.datatype.display&&(l={uuid:U()["".concat(T.uuid)]}),n.push({concept:{uuid:t.concept.uuid},status:"FINAL",order:{uuid:t.uuid},value:l})}var o={obs:n};(0,u.x1)(t.uuid,t.encounter.uuid,f,o,{fulfillerStatus:"COMPLETED",fulfillerComment:"Test Results Entered"},m).then((function(){E(!1),d(),q(),(0,s.showSnackbar)({title:_("saveLabResults","Save lab results"),kind:"success",subtitle:_("successfullySavedLabResults","Lab results for {{orderNumber}} have been successfully updated",{orderNumber:null==t?void 0:t.orderNumber})})}),(function(e){E(!1),(0,s.showSnackbar)({title:_("errorSavingLabResults","Error saving lab results"),kind:"error",subtitle:null==e?void 0:e.message})}))})),disabled:h,type:"submit"},h?a().createElement(i.lSo,{description:_("saving","Saving")+"..."}):_("saveAndClose","Save and close"))))}}}]);