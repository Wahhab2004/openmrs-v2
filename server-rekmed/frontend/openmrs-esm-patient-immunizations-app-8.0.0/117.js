"use strict";(globalThis.webpackChunk_openmrs_esm_patient_immunizations_app=globalThis.webpackChunk_openmrs_esm_patient_immunizations_app||[]).push([[117],{2996:(e,n,t)=>{t.d(n,{Z:()=>c});var a=t(272),i=t.n(a),r=t(2609),o=t.n(r)()(i());o.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79;--bottom-nav-height: 4rem;--workspace-header-height: 3rem;--tablet-workspace-window-height: calc(100vh - var(--omrs-navbar-height));--desktop-workspace-window-height: calc(100vh - var(--omrs-navbar-height) - var(--workspace-header-height))}.-esm-patient-immunizations__immunizations-form__container___BYMUM{margin:1rem}.-esm-patient-immunizations__immunizations-form__container___BYMUM section{margin:1rem 0}.-esm-patient-immunizations__immunizations-form__form___JmY4y{display:flex;flex-direction:column;justify-content:space-between;height:calc(100vh - 6rem)}.-esm-patient-immunizations__immunizations-form__button___MfHJO{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-immunizations__immunizations-form__tablet___X_Hrs{padding:1.5rem 1rem;background-color:#fff}.-esm-patient-immunizations__immunizations-form__desktop___ZaD77{padding:0rem}.-esm-patient-immunizations__immunizations-form__dateTimeSection___E20b5{display:flex}@media screen and (max-width: 600px){.-esm-patient-immunizations__immunizations-form__dateTimeSection___E20b5{flex-direction:column}}","",{version:3,sources:["webpack://./../../node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/immunizations/immunizations-form.scss","webpack://./../../node_modules/@carbon/layout/scss/generated/_spacing.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CACA,yBAAA,CACA,+BAAA,CACA,yEAAA,CACA,2GAAA,CCvDF,mEACE,WC0BW,CDxBX,2EACE,aAAA,CAIJ,8DACE,YAAA,CACA,qBAAA,CACA,6BAAA,CACA,yBAAA,CAGF,gEACE,WAAA,CACA,YAAA,CACA,wBAAA,CACA,oBAAA,CACA,aAAA,CAGF,gEACE,mBAAA,CACA,qBD5BM,CC+BR,iEACE,YAAA,CAGF,yEACE,YAAA,CAGF,qCACE,yEACE,qBAAA,CAAA",sourceRoot:""}]),o.locals={container:"-esm-patient-immunizations__immunizations-form__container___BYMUM",form:"-esm-patient-immunizations__immunizations-form__form___JmY4y",button:"-esm-patient-immunizations__immunizations-form__button___MfHJO",tablet:"-esm-patient-immunizations__immunizations-form__tablet___X_Hrs",desktop:"-esm-patient-immunizations__immunizations-form__desktop___ZaD77",dateTimeSection:"-esm-patient-immunizations__immunizations-form__dateTimeSection___E20b5"};const c=o},4117:(e,n,t)=>{t.r(n),t.d(n,{default:()=>q});var a=t(268),i=t.n(a),r=t(4924),o=t(7082),c=t(2870),u=t(3955),l=t(8883),m=t(195),s=t(2821),d=t(321),v=t.n(d),p=t(1195),f=t.n(p),A=t(3275),_=t.n(A),b=t(7162),g=t.n(b),C=t(2094),h=t.n(C),E=t(757),y=t.n(E),z=t(2996),w={};w.styleTagTransform=y(),w.setAttributes=g(),w.insert=_().bind(null,"head"),w.domAPI=f(),w.insertStyleElement=h(),v()(z.Z,w);const D=z.Z&&z.Z.locals?z.Z.locals:void 0;var x=t(3255),S=t(2710),T=t(3565),N=t.n(T),k=t(3697),M=function(e){var n=e.vaccine,t=e.sequences,c=e.control,l=(0,r.useTranslation)().t,m=(0,u.bc)({name:"doseNumber",control:c}).field,s=(0,a.useMemo)((function(){var e;return(null==t||null===(e=t.find((function(e){return e.vaccineConceptUuid===n})))||void 0===e?void 0:e.sequences)||[]}),[t,n]);return i().createElement("div",{className:D.row},s.length?i().createElement(o.Ltx,{id:"sequence",label:l("pleaseSelect","Please select"),titleText:l("sequence","Sequence"),items:(null==s?void 0:s.map((function(e){return e.sequenceNumber})))||[],itemToString:function(e){var n;return null===(n=s.find((function(n){return n.sequenceNumber===e})))||void 0===n?void 0:n.sequenceLabel},onChange:function(e){return m.onChange(parseInt(e.selectedItem||0))},selectedItem:m.value}):i().createElement(o.Y2U,{id:"doseNumber",label:l("doseNumber","Dose number within series"),min:0,onChange:function(e){return m.onChange(parseInt(e.target.value||0))},value:m.value,hideSteppers:!0}))},U=t(1317);function B(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=new Array(n);t<n;t++)a[t]=e[t];return a}function I(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var a,i,r=[],o=!0,c=!1;try{for(t=t.call(e);!(o=(a=t.next()).done)&&(r.push(a.value),!n||r.length!==n);o=!0);}catch(e){c=!0,i=e}finally{try{o||null==t.return||t.return()}finally{if(c)throw i}}return r}}(e,n)||function(e,n){if(e){if("string"==typeof e)return B(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?B(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var F="d/m/Y";const q=function(e){var n,t,d,v,p,f,A=e.patientUuid,_=e.closeWorkspace,b=e.closeWorkspaceWithSavedChanges,g=e.promptBeforeClosing,C=(0,r.useTranslation)().t,h=I((0,a.useState)(!1),2),E=h[0],y=h[1],z=(0,c.useConfig)().immunizationsConfig,w=(0,c.useSession)(),T=(0,c.useVisit)(A).currentVisit,B="tablet"===(0,c.useLayoutType)(),q=(d=z,v=(0,x.ZP)("".concat(c.restBaseUrl,"/concept?references=").concat(d.immunizationConceptSet,"&v=").concat("custom:(uuid,display,answers:(uuid,display),conceptMappings:(conceptReferenceTerm:(conceptSource:(name),code)))"),c.openmrsFetch),p=v.data,v.error,f=v.isLoading,{immunizationsConceptSet:p&&p.data.results[0],isLoading:f}).immunizationsConceptSet,P=(0,U.d)(A).mutate,W=I((0,a.useState)(),2),R=W[0],L=W[1],O=(0,a.useMemo)((function(){return m.z.object({vaccineUuid:m.z.string().refine((function(e){return!!e}),C("vaccineRequired","Vaccine required")),vaccinationDate:m.z.date().refine((function(e){return!!e}),C("vaccinationDateRequired","Vaccination date required")),vaccinationTime:m.z.string(),timeFormat:m.z.enum(["PM","AM"]),doseNumber:m.z.number().nullable().transform((function(e){return e<1?null:e})),expirationDate:m.z.date().nullable(),lotNumber:m.z.string().nullable(),manufacturer:m.z.string().nullable()})}),[C]),j=(0,u.cI)({mode:"all",resolver:(0,l.F)(O),defaultValues:{vaccineUuid:"",vaccinationDate:new Date,vaccinationTime:N()(new Date).format("hh:mm"),timeFormat:(new Date).getHours()>=12?"PM":"AM",doseNumber:0,expirationDate:null,lotNumber:"",manufacturer:""}}),Y=j.control,Q=j.handleSubmit,V=j.reset,Z=j.formState,H=Z.errors,G=Z.isDirty,J=j.watch;(0,a.useEffect)((function(){g((function(){return G}))}),[G,g]);var X=J("vaccineUuid");(0,a.useEffect)((function(){var e=k.sD.subscribe((function(e){if(e){var n=e.vaccinationDate||new Date;V({vaccineUuid:e.vaccineUuid,vaccinationDate:n,vaccinationTime:N()(n).format("hh:mm"),timeFormat:n.getHours()>=12?"PM":"AM",doseNumber:e.doseNumber,expirationDate:e.expirationDate,lotNumber:e.lotNumber,manufacturer:e.manufacturer}),L({immunizationObsUuid:e.immunizationId,visitUuid:e.visitId})}}));return function(){e.unsubscribe(),k.sD.next(null)}}),[V]);var K=(0,a.useCallback)((function(e){var n,t;y(!0);var a=e.vaccineUuid,i=e.vaccinationDate,r=e.doseNumber,o=e.expirationDate,u=e.lotNumber,l=e.manufacturer,m=e.timeFormat,d=e.vaccinationTime,v=new AbortController,p=I((0,s.convertTime12to24)(d,m),2),f=p[0],_=p[1],g={patientUuid:A,immunizationId:null==R?void 0:R.immunizationObsUuid,vaccineName:q.answers.find((function(e){return e.uuid===a})).display,vaccineUuid:a,vaccinationDate:(0,c.toDateObjectStrict)((0,c.toOmrsIsoString)(new Date(N()(i).year(),N()(i).month(),N()(i).date(),f,_))),doseNumber:r,expirationDate:o,lotNumber:u,manufacturer:l};return function(e,n,t){var a="".concat(c.fhirBaseUrl,"/Immunization");return n&&(a="".concat(a,"/").concat(n)),(0,c.openmrsFetch)(a,{headers:{"Content-Type":"application/json"},method:n?"PUT":"POST",body:e,signal:t.signal})}((0,S.j)(g,(null==R?void 0:R.visitUuid)||(null==T?void 0:T.uuid),null==w||null===(n=w.sessionLocation)||void 0===n?void 0:n.uuid,null==w||null===(t=w.currentProvider)||void 0===t?void 0:t.uuid),null==R?void 0:R.immunizationObsUuid,v).then((function(){y(!1),b(),P(),(0,c.showSnackbar)({kind:"success",title:C("vaccinationSaved","Vaccination saved successfully"),isLowContrast:!0})}),(function(e){y(!1),(0,c.showSnackbar)({title:C("errorSaving","Error saving vaccination"),kind:"error",isLowContrast:!1,subtitle:null==e?void 0:e.message})})),function(){return v.abort()}}),[null==w||null===(n=w.sessionLocation)||void 0===n?void 0:n.uuid,A,null==w||null===(t=w.currentProvider)||void 0===t?void 0:t.uuid,null==T?void 0:T.uuid,R,q,b,C,P]);return i().createElement(u.RV,j,i().createElement(o.l09,{className:D.form,onSubmit:Q(K),"data-testid":"immunization-form"},i().createElement(o.Kqy,{gap:1,className:D.container},i().createElement("section",{className:" ".concat(D.row)},i().createElement("div",{className:D.dateTimeSection},i().createElement(c.ResponsiveWrapper,null,i().createElement(u.Qr,{name:"vaccinationDate",control:Y,render:function(e){var n,t=e.field,a=t.onChange,r=t.value;return i().createElement(o.Mtg,{id:"vaccinationDate",maxDate:(new Date).toISOString(),dateFormat:F,datePickerType:"single",value:r,onChange:function(e){var n=I(e,1)[0];return a(n)},style:{paddingBottom:"1rem"}},i().createElement(o.aj6,{id:"vaccinationDateInput",placeholder:"dd/mm/yyyy",labelText:C("vaccinationDate","Vaccination Date"),type:"text",invalid:!!H.vaccinationDate,invalidText:null===(n=H.vaccinationDate)||void 0===n?void 0:n.message,style:{width:"100%"}}))}})),i().createElement(c.ResponsiveWrapper,null,i().createElement(u.Qr,{name:"vaccinationTime",control:Y,render:function(e){var n=e.field,t=n.onBlur,a=n.onChange,r=n.value;return i().createElement(o.jII,{id:"vaccinationTime",labelText:C("time","Time"),onChange:function(e){return a(e.target.value)},pattern:"^(1[0-2]|0?[1-9]):([0-5]?[0-9])$",style:{marginLeft:"0.125rem",flex:"none"},value:r,onBlur:t},i().createElement(u.Qr,{name:"timeFormat",control:Y,render:function(e){var n=e.field,t=n.onChange,a=n.value;return i().createElement(o.M6n,{id:"timeFormatSelect",onChange:function(e){return t(e.target.value)},value:a,"aria-label":C("timeFormat ","Time Format")},i().createElement(o.QlF,{value:"AM",text:"AM"}),i().createElement(o.QlF,{value:"PM",text:"PM"}))}}))}})))),i().createElement("section",null,i().createElement(c.ResponsiveWrapper,null,i().createElement(u.Qr,{name:"vaccineUuid",control:Y,render:function(e){var n,t=e.field,a=t.onChange,r=t.value;return i().createElement("div",{className:D.row},i().createElement(o.Ltx,{id:"immunization",label:C("pleaseSelect","Please select"),titleText:C("immunization","Immunization"),items:(null==q||null===(n=q.answers)||void 0===n?void 0:n.map((function(e){return e.uuid})))||[],itemToString:function(e){var n;return null==q||null===(n=q.answers.find((function(n){return n.uuid==e})))||void 0===n?void 0:n.display},onChange:function(e){return a(e.selectedItem)},selectedItem:r,invalid:!!(null==H?void 0:H.vaccineUuid)}))}}))),(null==H?void 0:H.vaccineUuid)&&i().createElement("section",null,i().createElement("div",{className:D.row},i().createElement(o.K0D,{role:"alert",style:{margin:"0",minWidth:"100%"},kind:"error",lowContrast:!0,title:C("error","Error"),subtitle:H.vaccineUuid.message}))),X&&i().createElement("section",null,i().createElement(c.ResponsiveWrapper,null,i().createElement(M,{vaccine:X,sequences:z.sequenceDefinitions,control:Y}))),i().createElement("section",null,i().createElement(c.ResponsiveWrapper,null,i().createElement(u.Qr,{name:"manufacturer",control:Y,render:function(e){var n=e.field,t=n.onChange,a=n.value;return i().createElement("div",{className:D.row},i().createElement(o.oil,{type:"text",id:"manufacturer",labelText:C("manufacturer","Manufacturer"),value:a,onChange:function(e){return t(e.target.value)}}))}}))),i().createElement("section",null,i().createElement(c.ResponsiveWrapper,null,i().createElement(u.Qr,{name:"lotNumber",control:Y,render:function(e){var n=e.field,t=n.onChange,a=n.value;return i().createElement("div",{className:D.row},i().createElement(o.oil,{type:"text",id:"lotNumber",labelText:C("lotNumber","Lot Number"),value:a,onChange:function(e){return t(e.target.value)}}))}}))),i().createElement("section",null,i().createElement(c.ResponsiveWrapper,null,i().createElement(u.Qr,{name:"expirationDate",control:Y,render:function(e){var n=e.field,t=n.onChange,a=n.value;return i().createElement("div",{className:D.row},i().createElement(o.Mtg,{id:"vaccinationExpiration",className:"vaccinationExpiration",minDate:R?null:(new Date).toISOString(),dateFormat:F,datePickerType:"single",value:a,onChange:function(e){var n=I(e,1)[0];return t(n)}},i().createElement(o.aj6,{id:"date-picker-calendar-id",placeholder:"dd/mm/yyyy",labelText:C("expirationDate","Expiration Date"),type:"text"})))}})))),i().createElement(o.uVA,{className:B?D.tablet:D.desktop},i().createElement(o.zxk,{className:D.button,kind:"secondary",onClick:_},C("cancel","Cancel")),i().createElement(o.zxk,{className:D.button,kind:"primary",disabled:E,type:"submit"},C("save","Save")))))}}}]);